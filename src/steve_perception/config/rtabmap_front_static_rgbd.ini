# rtabmap_front_static_rgbd.ini
#
# This file is passed to rtabmap via:
#   cfg:=/path/to/this.ini
#
# How to think:
# - These keys tune RTAB-Map's internal behavior.
# - The launch file chooses sensors + topics + which nodes run.
#
# Rule of thumb:
# - If you are changing "what to subscribe to" -> launch args.
# - If you are changing "when to add nodes, how loop closures work, odom strategy" -> here.

# ---------------------------
# Core graph / memory behavior
# ---------------------------

# Add new nodes while mapping (SLAM mode)
Mem/IncrementalMemory=true
Mem/InitWMWithAllNodes=false

# Don't create a new node for every tiny motion.
# If you see "too many nodes" / map exploding -> increase these.
# If you see "not enough nodes" / blurry map -> decrease a bit.
RGBD/LinearUpdate=0.15
RGBD/AngularUpdate=0.10

# Sometimes useful if you have ugly drift:
# try forcing RTAB to use proximity constraints more.
# (Leave off initially; it can also add wrong constraints if odom is bad.)
# RGBD/ProximityBySpace=true
# RGBD/ProximityByTime=false
# RGBD/ProximityPathMaxNeighbors=10

# ---------------------------
# Registration strategy
# ---------------------------

# Reg/Strategy:
# 0 = purely visual registration
# 1 = ICP
# 2 = Visual + ICP
#
# For "front RGB-D only" with visual odom already running, stay with visual (0).
Reg/Strategy=0

# If later you fuse LiDAR or want stronger geometric alignment:
# Reg/Strategy=1   # ICP
# Reg/Strategy=2   # Visual+ICP

# ---------------------------
# Loop closure robustness
# ---------------------------

# If you accept too many false loop closures -> increase thresholds.
# If you never close loops -> loosen a bit.
Vis/MinInliers=15
Rtabmap/LoopThr=0.11

# Reject loop closures that cause huge jumps (good safety).
RGBD/OptimizeMaxError=3.0

# ---------------------------
# Speed / stability knobs
# ---------------------------

# Reduce compute if you're overloaded (and dropping frames).
# Rtabmap/DetectionRate=2.0  # you already set this in launch? if not, add here

# Keep this OFF for now: occupancy grid generation from depth is expensive and noisy.
# (You can turn it on if you specifically need 2D grid from depth.)
RGBD/CreateOccupancyGrid=false

# ---------------------------
# Depth handling assumptions
# ---------------------------

# Critical: RTAB assumes depth is registered to RGB if you feed rgb+depth+rgb camera_info.
# If your depth is not registered, you'll see distortions.
# That is not fixed by “tuning”; it is fixed by correct driver configuration or preprocessing.
#
# (No direct parameter here magically re-registers depth for you.)
