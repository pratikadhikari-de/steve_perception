# RTAB-Map internal parameters (INI).
# These are NOT “ROS params”. RTAB wants many of its internal params as strings,
# and the INI is the cleanest way to keep them in one place.

# Mental model:
# - Odometry (ICP here) gives you a *local* trajectory estimate.
# - RTAB-Map builds a graph of keyframes (nodes).
# - Loop closure adds constraints between old/new nodes.
# - Optimization can move old nodes => map gets “rewritten”.

# --- General ---
Rtabmap/DetectionRate=2.0          # Hz: how often to add new nodes / do detection
Mem/IncrementalMemory=true         # mapping mode
Mem/InitWMWithAllNodes=false       # only for localization mode

# If you see too many nodes too quickly, increase these:
RGBD/LinearUpdate=0.10             # meters before new node
RGBD/AngularUpdate=0.10            # radians before new node (~5.7 deg)

# --- Loop closure / graph optimization behavior ---
RGBD/NeighborLinkRefining=true     # refine constraints between consecutive nodes
RGBD/OptimizeFromGraphEnd=false    # keep map->odom behavior stable in some cases
RGBD/OptimizeMaxError=3.0          # reject loop closures that cause huge errors

# --- Registration strategy ---
# 0=Visual, 1=ICP, 2=Visual+ICP
# Since you are feeding odom from LiDAR ICP, keep registration conservative.
Reg/Strategy=1

# If your robot is planar, forcing 3DoF inside RTAB helps avoid weird vertical drift.
Reg/Force3DoF=true

# --- ICP tuning (used for scan matching inside RTAB constraints) ---
Icp/VoxelSize=0.05
Icp/MaxCorrespondenceDistance=0.3
Icp/PointToPlane=false
Icp/Iterations=10
Icp/CorrespondenceRatio=0.2

# --- Depth / cloud handling ---
# You can downsample later; don’t try to be fancy before the graph is stable.
# Grid/FromDepth is for 2D occupancy grid from depth; you don’t need it right now.
Grid/FromDepth=false
